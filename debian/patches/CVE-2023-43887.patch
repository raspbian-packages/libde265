From 63b596c915977f038eafd7647d1db25488a8c133 Mon Sep 17 00:00:00 2001
From: Dirk Farin <dirk.farin@gmail.com>
Date: Fri, 1 Sep 2023 21:18:48 +0200
Subject: [PATCH] fix #418

---
 libde265/decctx.cc | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

Index: libde265/libde265/decctx.cc
===================================================================
--- libde265.orig/libde265/decctx.cc
+++ libde265/libde265/decctx.cc
@@ -854,16 +854,17 @@ de265_error decoder_context::read_pps_NA
   std::shared_ptr<pic_parameter_set> new_pps = std::make_shared<pic_parameter_set>();
 
   bool success = new_pps->read(&reader,this);
+  if (!success) {
+    return DE265_WARNING_PPS_HEADER_INVALID;
+  }
 
   if (param_pps_headers_fd>=0) {
     new_pps->dump(param_pps_headers_fd);
   }
 
-  if (success) {
-    pps[ (int)new_pps->pic_parameter_set_id ] = new_pps;
-  }
+  pps[ (int)new_pps->pic_parameter_set_id ] = new_pps;
 
-  return success ? DE265_OK : DE265_WARNING_PPS_HEADER_INVALID;
+  return DE265_OK;
 }
 
 de265_error decoder_context::read_sei_NAL(bitreader& reader, bool suffix)
